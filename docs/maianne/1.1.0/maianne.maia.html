<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: maianne.maia</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: maianne.maia</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env maiascript

///
/// @license
/// Copyright 2020 Roberto Luiz Souza Monteiro,
///                Renata Souza Barreto,
///                Hernane Borges de Barros Pereira.
///
/// Licensed under the Apache License, Version 2.0 (the "License")
/// you may not use this file except in compliance with the License.
/// You may obtain a copy of the License at
///
///   http://www.apache.org/licenses/LICENSE-2.0
///
/// Unless required by applicable law or agreed to in writing, software
/// distributed under the License is distributed on an "AS IS" BASIS,
/// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, eitherMath.express or implied.
/// See the License for the specific language governing permissions and
/// limitations under the License.
///

///
/// MaiaApp core class.
/// @namespace maianne
///
namespace maianne {
    appTitle = "MaiaNNE"
    appName = "maianne"
    scriptPath = "./"
    cnaLibrary = this.scriptPath + "/maia/cna/cna.maia"
    statisticsLibrary = this.scriptPath + "/maia/statistics/statistics.maia"
    
    /// Starts the application and processes the data passed as command line arguments.
    /// @method run
    /// @memberof maianne
    function run() {
        // Supports only the Node.js interpreter.
        if (core.type(process) != "undefined") {
            command = "node"
            
            fs = system.require("fs")

            realPath = fs.realpathSync(system.argv[0])
            filePath = realPath.split("/")
            filePath = core.slice(filePath, 0, filePath.length - 2)
            filePath = filePath.join("/")
            this.scriptPath = filePath
            cnaLibrary = this.scriptPath + "/maia/cna/cna.maia"
            system.source(this.cnaLibrary)
            statisticsLibrary = this.scriptPath + "/maia/statistics/statistics.maia"
            system.source(this.statisticsLibrary)
            readTextFile = fs.readFileSync

            // Read file callback.
            function readFile(input) {
                content = readTextFile(input, "utf-8")
                return(content)
            }
            
            // Callback.
            function trainingCallback(epochs, RSS, correctness, ETL) {
                system.println(core.toString(epochs) + "," + core.toString(RSS) + "," + core.toString(correctness) + "," + core.toString(ETL))
            }
            
            // Command line options.
            inputFile = ""
            outputFile = ""
            reportFile = ""
            csvFile = ""
            correctnessFile = ""
            annFile = ""
            annOutputFile = ""
            itsFile = ""
            otsFile = ""
            linesToSkip = 0
            separator = ","
            lRate = 0.45
            af = "tanh"
            oaf = "linear"
            of = "none"
            ofc = [1, 0]
            allowLoops = false
            prepare = false
            negativeWeights = false
            maxEpochs = 1
            minimumCorrectness = 1.0
            interval = 0
            
            createANN = false
            topology = "mlp"
            vertices = 0
            edges = 0
            probability = 0
            avgdeg = 0
            ni = 0
            no = 0
            nl = 0
            nhu = 0
            prefix = "sample"
            nFiles = 1
            indexFrom = 1
            indexTo = 1
            indexIn = 1
            separateColumn = false
            columnNumber = 0
            replaceGivenPattern = false
            patternString = ""
            replacementString = ""
            splitFile = false
            nFirst = 1
            normalizeData = false
            denormalizeData = false
            minimum = ""
            maximum = ""
            nextStep = false
            steps = 1
            automaticTraining = false

            // Get command line arguments.
            if (system.argc > 1) {
                i = 1
                while (i &lt; system.argc) {
                    if ((system.argv[i] == "-h") | (system.argv[i] == "--help")) {
                        system.log(maianne.appTitle + " Command Line Interface (CLI)")
                        system.log("Usage: " + maianne.appName + " [options] [input file] [--] [arguments]")
                        system.log("Options:")
                        system.log("-h     --help               Displays this help message.")
                        system.log("-i     [input file]         Input file name.")
                        system.log("-o     [output file]        Output file name.")
                        system.log("-r                          Statistics report file.")
                        system.log("-c                          Statistics CSV file.")
                        system.log("       --cf                 Correctness CSV file.")
                        system.log("       --ann                The artificial neural network file.")
                        system.log("       --annout             The artificial neural network output file.")
                        system.log("       --its                Input training set file.")
                        system.log("       --ots                Output training set file.")
                        system.log("       --skipfirst          Skip first line of input and output training set files.")
                        system.log("       --separator          Training set files column separator(default=,).")
                        system.log("       --lrate              Learning rate (default=0.45).")
                        system.log("       --af                 Activation function (default=logistic).")
                        system.log("       --oaf                Output layer activation function (default=logistic).")
                        system.log("       --of                 Output function(default=step).")
                        system.log("       --ofc                Output function coefficients.")
                        system.log("       --loops              Allow loops in network(biases).")
                        system.log("       --prepare            Prepare the artificil neural network to learning.")
                        system.log("       --nw                 Allow initial negative weights.")
                        system.log("       --epochs             Max number of epochs to learning.")
                        system.log("       --correct            Target correctness.")
                        system.log("       --interval           Epochs interval to show the learning progress.")
                        system.log("       --create             Create an artificial neural network.")
                        system.log("       --topology           Create an artificial neural network.")
                        system.log("       --vertices           Number of vertices.")
                        system.log("       --edges              Number of edges.")
                        system.log("       --probability        Edge probability.")
                        system.log("       --avgdeg             Average degree.")
                        system.log("       --ni                 Number of input neurons.")
                        system.log("       --no                 Number of output neurons.")
                        system.log("       --nl                 Number of layers")
                        system.log("       --nhu                Number of hidden units.")
                        system.log("       --prefix             Prefix for multiple neural network files (default=sample).")
                        system.log("       --nfiles             Number of files for multiple neural network files.")
                        system.log("       --from               First file index for multiple neural network files.")
                        system.log("       --to                 Last file index for multiple neural network files.")
                        system.log("       --in                 Total number of files in the file set.")
                        system.log("       --column             Creates a new time series containing only the specified column.")
                        system.log("       --replace            Replace lines whit pattern in a time series with a given value.")
                        system.log("       --with               Replacement value for the given pattern.")
                        system.log("       --split              Split a file into two parts.")
                        system.log("       --nfirst             Number of lines of the first file to split.")
                        system.log("       --normalize          Normalizes a time series.")
                        system.log("       --denormalize        Denormalizes a time series.")
                        system.log("       --minimum            The minimum value of the time series.")
                        system.log("       --maximum            The maximum value of the time series.")
                        system.log("       --nextstep           Creates a new series containing the next steps for each value of the given series.")
                        system.log("       --steps              Number of next steps.")
                        system.log("       --auto               It reads several data files, creates a network file for each of them and trains the network according to the indicated parameters.")
                        process.exit(0)
                    } elseif (system.argv[i] == "-i") {
                        i = i + 1
                        inputFile = system.argv[i]
                    } elseif (system.argv[i] == "-o") {
                        i = i + 1
                        outputFile = system.argv[i]
                    } elseif (system.argv[i] == "-r") {
                        i = i + 1
                        reportFile = system.argv[i]
                    } elseif (system.argv[i] == "-c") {
                        i = i + 1
                        csvFile = system.argv[i]
                    } elseif (system.argv[i] == "--cf") {
                        i = i + 1
                        correctnessFile = system.argv[i]
                    } elseif (system.argv[i] == "--ann") {
                        i = i + 1
                        annFile = system.argv[i]
                    } elseif (system.argv[i] == "--annout") {
                        i = i + 1
                        annOutputFile = system.argv[i]
                    } elseif (system.argv[i] == "--its") {
                        i = i + 1
                        itsFile = system.argv[i]
                    } elseif (system.argv[i] == "--ots") {
                        i = i + 1
                        otsFile = system.argv[i]
                    } elseif (system.argv[i] == "--skipfirst") {
                        linesToSkip = 1
                    } elseif (system.argv[i] == "--separator") {
                        i = i + 1
                        separator = system.argv[i]
                    } elseif (system.argv[i] == "--lrate") {
                        i = i + 1
                        lRate = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--af") {
                        i = i + 1
                        af = system.argv[i]
                    } elseif (system.argv[i] == "--oaf") {
                        i = i + 1
                        oaf = system.argv[i]
                    } elseif (system.argv[i] == "--of") {
                        i = i + 1
                        of = system.argv[i]
                    } elseif (system.argv[i] == "--ofc") {
                        i = i + 1
                        ofc = core.eval(system.argv[i])
                    } elseif (system.argv[i] == "--loops") {
                        allowLoops = true
                    } elseif (system.argv[i] == "--prepare") {
                        prepare = true
                    } elseif (system.argv[i] == "--nw") {
                        negativeWeights = true
                    } elseif (system.argv[i] == "--epochs") {
                        i = i + 1
                        maxEpochs = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--correct") {
                        i = i + 1
                        minimumCorrectness = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--interval") {
                        i = i + 1
                        interval = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--create") {
                        createANN = true
                    } elseif (system.argv[i] == "--topology") {
                        i = i + 1
                        topology = system.argv[i]
                    } elseif (system.argv[i] == "--vertices") {
                        i = i + 1
                        vertices = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--edges") {
                        i = i + 1
                        edges = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--probability") {
                        i = i + 1
                        probability = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--avgdeg") {
                        i = i + 1
                        avgdeg = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--ni") {
                        i = i + 1
                        ni = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--no") {
                        i = i + 1
                        no = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--nl") {
                        i = i + 1
                        nl = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--nhu") {
                        i = i + 1
                        nhu = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--prefix") {
                        i = i + 1
                        prefix = system.argv[i]
                    } elseif (system.argv[i] == "--nfiles") {
                        i = i + 1
                        nFiles = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--from") {
                        i = i + 1
                        indexFrom = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--to") {
                        i = i + 1
                        indexTo = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--in") {
                        i = i + 1
                        indexIn = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--column") {
                        i = i + 1
                        columnNumber = system.argv[i]
                        separateColumn = true
                    } elseif (system.argv[i] == "--replace") {
                        i = i + 1
                        patternString = system.argv[i]
                        replaceGivenPattern = true
                    } elseif (system.argv[i] == "--with") {
                        i = i + 1
                        replacementString = system.argv[i]
                    } elseif (system.argv[i] == "--split") {
                        splitFile = true
                    } elseif (system.argv[i] == "--nfirst") {
                        i = i + 1
                        nFirst = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--normalize") {
                        normalizeData = true
                    } elseif (system.argv[i] == "--denormalize") {
                        denormalizeData = true
                    } elseif (system.argv[i] == "--minimum") {
                        i = i + 1
                        minimum = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--maximum") {
                        i = i + 1
                        maximum = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--nextstep") {
                        nextStep = true
                    } elseif (system.argv[i] == "--steps") {
                        i = i + 1
                        steps = core.toNumber(system.argv[i])
                    } elseif (system.argv[i] == "--auto") {
                        automaticTraining = true
                    } else {
                        annFile = system.argv[i]
                        break
                    }
                    i = i + 1
                }
                if (createANN) {
                    // Calculates the file index number range.
                    if (indexFrom &lt; 1) {
                        indexFrom = 1
                    }
                    if (indexTo &lt;= 1) {
                        if (nFiles > 1) {
                            indexTo = indexFrom + nFiles - 1
                        }
                    }
                    nFiles = indexTo - indexFrom + 1
                    if (indexIn &lt;= 1) {
                        indexIn = nFiles
                    }
                    for (nFile = indexFrom; nFile &lt;= indexTo; nFile = nFile + 1) {
                        if (nFiles > 1) {
                            outputFile = prefix + "-" + string.sprintf("%0" + core.length(core.toString(indexIn)) + "." + core.length(core.toString(indexIn)) + "d", nFile) + ".net"
                        }

                        property = {
                            "adj": [],
                            "n": 0,
                            "m": 0,
                            "directed": false,
                            "density": 0,
                            "networkLabel": [],
                            "networkDegree": [],
                            "networkAverageDegree": 0,
                            "networkDegreeDistribution": [],
                            "networkDensity": 0,
                            "networkClustering": [],
                            "networkAverageClustering": 0,
                            "networkShortestPath": [],
                            "networkAverageShortestPath": 0,
                            "networkDiameter": 0,
                            "networkCentrality": [],
                            "networkVertexEfficiency": [],
                            "networkGlobalEfficiency": 0
                        }
                        
                        property.adj = ann.createANN(topology, vertices, edges, probability, avgdeg, ni, no, nl, nhu)
                        fileContents = cna.createPajekFile(property.adj, "arcs")

                        // Sets the output file.
                        if (outputFile == "") {
                            outputFile = "output.net"
                        }

                        fs.writeFileSync(outputFile, fileContents)
                    }
                } elseif (separateColumn) {
                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    if (outputFile == "") {
                        outputFile = fileName + "-column-" + core.toString(columnNumber) + "." + fileExtension
                    }

                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, true)
                    outputData = statistics.getColumn(inputData, columnNumber)

                    fileContents = system.createCSV(outputData, separator)

                    fs.writeFileSync(outputFile, fileContents)
                } elseif (replaceGivenPattern) {
                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    if (outputFile == "") {
                        outputFile = fileName + "-replaced." + fileExtension
                    }

                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, false)
                    outputData = statistics.replacePattern(inputData, patternString, replacementString, true)

                    fileContents = system.createCSV(outputData, separator)
                    
                    fs.writeFileSync(outputFile, fileContents)
                } elseif (splitFile) {
                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    
                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, false)
                    outputData = statistics.splitData(inputData, nFirst)

                    outputFile1 = fileName + "-" + core.toString(outputData.part1.length) + "." + fileExtension
                    outputFile2 = fileName + "-" + core.toString(outputData.part2.length) + "." + fileExtension

                    fileContents1 = system.createCSV(outputData.part1, separator)
                    fileContents2 = system.createCSV(outputData.part2, separator)
                    
                    fs.writeFileSync(outputFile1, fileContents1)
                    fs.writeFileSync(outputFile2, fileContents2)
                } elseif (normalizeData &amp;&amp; !automaticTraining) {
                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    if (outputFile == "") {
                        outputFile = fileName + "-normalized." + fileExtension
                    }

                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, true)
                    avgData = statistics.getAverage(inputData)
                    outputData = statistics.normalize(inputData, avgData.minimum, avgData.maximum)

                    fileContents = system.createCSV(outputData, separator)
                    
                    fs.writeFileSync(outputFile, fileContents)

                    // Saves the report file.
                    reportFileContents = ""
                    reportFileContents = reportFileContents + "Average: " + core.toString(avgData.average) + "\n"
                    reportFileContents = reportFileContents + "Standard deviation: " + core.toString(avgData.deviation) + "\n"
                    reportFileContents = reportFileContents + "Standard error: " + core.toString(avgData.error) + "\n"
                    reportFileContents = reportFileContents + "Minimum value: "  + core.toString(avgData.minimum) + "\n"
                    reportFileContents = reportFileContents + "Maximum value: "  + core.toString(avgData.maximum) + "\n"
                    reportFileContents = reportFileContents + "Observations: "  + core.toString(avgData.n) + "\n"
                    
                    if (reportFile == "") {
                        reportFile = fileName + "-report.txt"
                    }

                    fs.writeFileSync(reportFile, reportFileContents)
                } elseif (denormalizeData) {
                    if ((core.type(minimum) != "number") || (core.type(maximum) != "number")) {
                        system.log("To denormalize a time series you need to provide the minimum and maximum values of the original, denormalized series.")
                        process.exit()
                    }

                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    if (outputFile == "") {
                        outputFile = fileName + "-denormalized." + fileExtension
                    }

                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, true)
                    outputData = statistics.denormalize(inputData, minimum, maximum)

                    fileContents = system.createCSV(outputData, separator)

                    fs.writeFileSync(outputFile, fileContents)
                } elseif (nextStep &amp;&amp; !automaticTraining) {
                    // Get the file without extension.
                    fileName = inputFile.split(".")
                    fileName = fileName.shift()

                    // Get the file name extension.
                    fileExtension = inputFile.split(".")
                    fileExtension = fileExtension.pop()
                    
                    if (outputFile == "") {
                        outputFile = fileName + "-steps." + fileExtension
                    }

                    inputData = system.loadCSV(inputFile, linesToSkip, separator, true, true)
                    outputData = statistics.getNextSteps(inputData, steps)

                    fileContents = system.createCSV(outputData, separator)

                    fs.writeFileSync(outputFile, fileContents)
                } elseif (automaticTraining) {
                    glob = system.require("glob")

                    // When passed the --auto option, the variable annFile contains a search string for multiple files.
                    inputFile = annFile

                    files = glob.sync(inputFile)

                    if (files.length == 0) {
                        system.log("File '" + inputFile + "' not found.")
                    } else {
                        system.log("Processing " + files.length + " files...")

                        for (fileNumber = 0; fileNumber &lt; files.length; fileNumber = fileNumber + 1) {
                            // Get the full file name.
                            file = files[fileNumber]

                            system.log("Processing file '" + file + "'...")

                            // Get the file without extension.
                            fileName = file.split(".")
                            fileName = fileName.shift()
                            // Get the file name extension.
                            fileExtension = file.split(".")
                            fileExtension = fileExtension.pop()
                            
                            // Create the ANN.
                            property = {
                                "adj": [],
                                "n": 0,
                                "m": 0,
                                "directed": false,
                                "density": 0,
                                "networkLabel": [],
                                "networkDegree": [],
                                "networkAverageDegree": 0,
                                "networkDegreeDistribution": [],
                                "networkDensity": 0,
                                "networkClustering": [],
                                "networkAverageClustering": 0,
                                "networkShortestPath": [],
                                "networkAverageShortestPath": 0,
                                "networkDiameter": 0,
                                "networkCentrality": [],
                                "networkVertexEfficiency": [],
                                "networkGlobalEfficiency": 0
                            }
                            property.adj = ann.createANN(topology, vertices, edges, probability, avgdeg, ni, no, nl, nhu)
                            
                            fileContents = cna.createPajekFile(property.adj, "arcs")
                            outputFile = fileName + "-ann.net"
                            fs.writeFileSync(outputFile, fileContents)

                            // Normalizes the data.
                            inputData = system.loadCSV(file, linesToSkip, separator, true, true)
 
                            // Extract a column.
                            if (separateColumn) {
                                dataColumn = statistics.getColumn(inputData, columnNumber)
                            } else {
                                dataColumn = inputData
                            }
                            
                            if (normalizeData) {
                                avgData = statistics.getAverage(dataColumn)
                                normalizedData = statistics.normalize(dataColumn, avgData.minimum, avgData.maximum)

                                fileContents = system.createCSV(normalizedData, separator)
                                outputFile = fileName + "-normalized." + fileExtension
                                fs.writeFileSync(outputFile, fileContents)
 
                                // Saves the report file.
                                reportFileContents = ""
                                reportFileContents = reportFileContents + "Average: " + core.toString(avgData.average) + "\n"
                                reportFileContents = reportFileContents + "Standard deviation: " + core.toString(avgData.deviation) + "\n"
                                reportFileContents = reportFileContents + "Standard error: " + core.toString(avgData.error) + "\n"
                                reportFileContents = reportFileContents + "Minimum value: "  + core.toString(avgData.minimum) + "\n"
                                reportFileContents = reportFileContents + "Maximum value: "  + core.toString(avgData.maximum) + "\n"
                                reportFileContents = reportFileContents + "Observations: "  + core.toString(avgData.n) + "\n"
                                reportFile = fileName + "-normalization-report.txt"
                                fs.writeFileSync(reportFile, reportFileContents)
                            } else {
                                normalizedData = dataColumn
                            }

                            // Split data in two parts: 70% for training and 30% for test.
                            nFirst = math.round(normalizedData.length * 0.7)
                            trainingSet = statistics.splitData(normalizedData, nFirst)

                            fileContents1 = system.createCSV(trainingSet.part1, separator)
                            fileContents2 = system.createCSV(trainingSet.part2, separator)
                            outputFile1 = fileName + "-" + core.toString(trainingSet.part1.length) + "." + fileExtension
                            outputFile2 = fileName + "-" + core.toString(trainingSet.part2.length) + "." + fileExtension
                            fs.writeFileSync(outputFile1, fileContents1)
                            fs.writeFileSync(outputFile2, fileContents2)

                            // Create a next step training set.
                            inputTrainingData = statistics.getNextSteps(trainingSet.part1, steps)
                            inputTestingData = statistics.getNextSteps(trainingSet.part2, steps)

                            fileContents = system.createCSV(inputTrainingData, separator)
                            outputFile = fileName + "-input-training." + fileExtension
                            fs.writeFileSync(outputFile, fileContents)

                            fileContents = system.createCSV(inputTestingData, separator)
                            outputFile = fileName + "-input-testing." + fileExtension
                            fs.writeFileSync(outputFile, fileContents)

                            outputTrainingData = trainingSet.part1.slice(steps, trainingSet.part1.length)
                            outputTestingData = trainingSet.part2.slice(steps, trainingSet.part2.length)

                            fileContents = system.createCSV(outputTrainingData, separator)
                            outputFile = fileName + "-output-training." + fileExtension
                            fs.writeFileSync(outputFile, fileContents)

                            fileContents = system.createCSV(outputTestingData, separator)
                            outputFile = fileName + "-output-testing." + fileExtension
                            fs.writeFileSync(outputFile, fileContents)

                            // Trains the neural network.
                            property.networkLabel = cna.getLabels(property.adj)

                            // Assigns random starting weights to neural synapses.
                            if (prepare) {
                                property.adj = ann.prepare(property.adj, true, allowLoops, negativeWeights)
                            } else {
                                property.adj = ann.prepare(property.adj, false, allowLoops, negativeWeights)
                            }

                            startTime := Date()
                            correctness = ann.training(property.adj, inputTrainingData, outputTrainingData, lRate, af, oaf, of, ofc, maxEpochs, minimumCorrectness, trainingCallback, interval)
                            endTime := Date()
                            elapsedTime = endTime - startTime

                            // Saves the trained network.
                            trainedAnn = ann.reduce(property.adj)
                            cna.setLabels(trainedAnn, property.networkLabel)

                            trainedAnnFileContents = cna.createPajekFile(trainedAnn, "arcs")
                            annOutputFile = fileName + "-ann-trained.net"
                            fs.writeFileSync(annOutputFile, trainedAnnFileContents)

                            // Saves correctness data.
                            correctnessFileContents = system.createCSV(correctness[2], separator, ["rss", "correctness"])
                            correctnessFile = fileName + "-correctness.csv"
                            fs.writeFileSync(correctnessFile, correctnessFileContents)

                            // Saves the report file.
                            finalEpochs = core.toString(correctness[0])
                            finalRss = core.toString(correctness[1])
                            finalCorrectness = core.toString(correctness[2, core.length(correctness[2]) - 1, 1])

                            reportFileContents = ""
                            reportFileContents = reportFileContents + "Epochs: " + finalEpochs + "\n"
                            reportFileContents = reportFileContents + "RSS: " + finalRss + "\n"
                            reportFileContents = reportFileContents + "Correctness: "  + finalCorrectness + "\n"
                            reportFileContents = reportFileContents + "Elapsed Time: "  + elapsedTime + "\n"
                            reportFile = fileName + "-training-report.txt"
                            fs.writeFileSync(reportFile, reportFileContents)

                            // Uses the trained network to process the input data.
                            outputData = []
                            for (indexData = 0; indexData &lt; inputTestingData.length; indexData = indexData + 1) {
                                inData = inputTestingData[indexData]
                                outData = ann.think(property.adj, inData, ni, no, af, oaf, of, ofc)
                                outputData.push(outData)
                            }

                            outputFileContents = system.createCSV(outputData, separator)
                            outputFile = fileName + "-ann-output.csv"
                            fs.writeFileSync(outputFile, outputFileContents)
                        }
                    }
                } else {
                    if (annFile != "") {
                        local Glob = system.require("glob")
                        // Process each file based on glob pattern.
                        function processFiles(er, files) {
                            if (files.length == 0) {
                                system.log(maianne.appTitle + " Command Line Interface (CLI)")
                                system.log("Usage: " + maianne.appName + " [options] [input file] [--] [arguments]")
                            } else {
                                for (i = 0; i &lt; files.length; i = i + 1) {
                                    // Get the full file name.
                                    file = files[i]
                                    
                                    // Get the file without extension.
                                    fileName = file.split(".")
                                    fileName = fileName.shift()

                                    // Get the file name extension.
                                    fileExtension = file.split(".")
                                    fileExtension = fileExtension.pop()

                                    // Read the file contents.
                                    fileContents = readFile(file)

                                    property = {
                                        "adj": [],
                                        "n": 0,
                                        "m": 0,
                                        "directed": false,
                                        "networkLabel": [],
                                        "networkDegree": [],
                                        "networkAverageDegree": 0,
                                        "networkDegreeDistribution": [],
                                        "networkDensity": 0,
                                        "networkClustering": [],
                                        "networkAverageClustering": 0,
                                        "networkShortestPath": [],
                                        "networkAverageShortestPath": 0,
                                        "networkDiameter": 0,
                                        "networkCentrality": [],
                                        "networkVertexEfficiency": [],
                                        "networkGlobalEfficiency": 0
                                    }

                                    // Parses file contents.
                                    if (fileExtension == "json") {
                                        network = JSON.parse(fileContents)
                                        pajekFileContents = cna.jsonToPajekFile(network)
                                        property.adj = cna.parsePajekFile(pajekFileContents, property)
                                        property.networkLabel = cna.getLabels(property.adj)
                                    } elseif (fileExtension == "net") {
                                        property.adj = cna.parsePajekFile(fileContents, property)
                                        property.networkLabel = cna.getLabels(property.adj)
                                    } else {
                                        system.log("Unsupported file format when processing file " + file + "")
                                        process.exit()
                                    }

                                    // Assigns random starting weights to neural synapses.
                                    if (prepare) {
                                        property.adj = ann.prepare(property.adj, true, allowLoops, negativeWeights)
                                    } else {
                                        property.adj = ann.prepare(property.adj, false, allowLoops, negativeWeights)
                                    }

                                    if ((itsFile != "") &amp;&amp; (otsFile != "")) {
                                        // Reads the train set.
                                        itsData = system.loadCSV(itsFile, linesToSkip, separator, true, true)
                                        otsData = system.loadCSV(otsFile, linesToSkip, separator, true, true)

                                        // Trains the neural network.
                                        startTime := Date()
                                        correctness = ann.training(property.adj, itsData, otsData, lRate, af, oaf, of, ofc, maxEpochs, minimumCorrectness, trainingCallback, interval)
                                        endTime := Date()
                                        elapsedTime = endTime - startTime

                                        // Saves the trained network.
                                        trainedAnn = ann.reduce(property.adj)
                                        cna.setLabels(trainedAnn, property.networkLabel)
                                        trainedAnnFileContents = cna.createPajekFile(trainedAnn, "arcs")

                                        // Sets the output file.
                                        if (annOutputFile == "") {
                                            annOutputFile = fileName + "-trained.net"
                                        }

                                        fs.writeFileSync(annOutputFile, trainedAnnFileContents)

                                        // Saves correctness data.
                                        correctnessFileContents = system.createCSV(correctness[2], separator, ["rss", "correctness"])

                                        if (correctnessFile == "") {
                                            correctnessFile = fileName + "-correctness.csv"
                                        }

                                        fs.writeFileSync(correctnessFile, correctnessFileContents)

                                        // Saves the report file.
                                        finalEpochs = core.toString(correctness[0])
                                        finalRss = core.toString(correctness[1])
                                        finalCorrectness = core.toString(correctness[2, core.length(correctness[2]) - 1, 1])

                                        reportFileContents = ""
                                        reportFileContents = reportFileContents + "Epochs: " + finalEpochs + "\n"
                                        reportFileContents = reportFileContents + "RSS: " + finalRss + "\n"
                                        reportFileContents = reportFileContents + "Correctness: "  + finalCorrectness + "\n"
                                        reportFileContents = reportFileContents + "Elapsed Time: "  + elapsedTime + "\n"
                                        
                                        if (reportFile == "") {
                                            reportFile = fileName + "-report.txt"
                                        }

                                        fs.writeFileSync(reportFile, reportFileContents)
                                    }
                                    
                                    // Uses the trained network to process the input data.
                                    if (inputFile != "") {
                                        inputData = system.loadCSV(inputFile, linesToSkip, separator, true, true)
                                        outputData = []

                                        if (steps > 1) {
                                            for (indexData = 0; indexData &lt; inputData.length - steps; indexData = indexData + steps) {
                                                inData = inputData[indexData]
                                                for (indexStep = 0; indexStep &lt; steps; indexStep = indexStep + 1) {
                                                    outData = ann.think(property.adj, inData, ni, no, af, oaf, of, ofc)
                                                    outputData.push(outData)
                                                    inData.shift()
                                                    inData.push(outData)
                                                }
                                            }
                                        } else {
                                            for (indexData = 0; indexData &lt; inputData.length; indexData = indexData + 1) {
                                                inData = inputData[indexData]
                                                outData = ann.think(property.adj, inData, ni, no, af, oaf, of, ofc)
                                                outputData.push(outData)
                                            }
                                        }

                                        outputFileContents = system.createCSV(outputData, separator)

                                        // Sets the output file.
                                        if (outputFile == "") {
                                            outputFile = fileName + "-output.csv"
                                        }

                                        fs.writeFileSync(outputFile, outputFileContents)

                                        outputFile = ""
                                    }
                                }
                            }
                        }

                        options = []

                        // Get all file names based on glob pattern.
                        local glob := Glob(annFile, options, processFiles)
                    } else {
                        system.log(maianne.appTitle + " Command Line Interface (CLI)")
                        system.log("Usage: " + maianne.appName + " [options] [input file] [--] [arguments]")
                    }
                }
            } else {
                system.log(maianne.appTitle + " Command Line Interface (CLI)")
                system.log("Usage: " + maianne.appName + " [options] [input file] [--] [arguments]")
            }
        }
    }
}

// Run the MaiaApp code if this script has been invoked
// from the command line.
if (core.type(process) != "undefined") {
    maianne.run()
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="maianne.html">maianne</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Thu Aug 18 2022 00:49:30 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
